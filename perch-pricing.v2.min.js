"use strict";(()=>{const e=window.location.href.includes("staging");function t(...t){e&&console.log("[Perch Debug]",...t)}function n(e,t){return Array.from(e.querySelectorAll(t))}function a(e,t){return e.querySelector(t)}async function r(e){return new Promise((t=>setTimeout(t,e)))}function o(e,t){return e.startsWith(t)?e.substring(t.length):e}function l(e){return`$${e.toLocaleString("en-US")}`}function c(e){t("Showing error:",e),"quantity"===e?($.forEach((e=>{e&&(e.style.display="block")})),N.forEach((e=>{e&&(e.style.display="none")}))):"plan"===e&&($.forEach((e=>{e&&(e.style.display="none")})),N.forEach((e=>{e&&(e.style.display="block")}))),H.forEach((e=>{e&&(e.style.display="flex")})),R()}const i="cc-active",s="United States",u="selection-null",d=e=>`[pp='${e}']`;t("Initializing Perch Pricing Calculator v2.3.2");const y=document.querySelector(d("section-1")),p=document.querySelector(d("section-2"));if(t("Sections found:",!!y,!!p),!y||!p)return void t("Required sections not found, exiting");const h=document.querySelector(d("preloader"));t("Preloader found:",!!h),h||t("Preloader not found, continuing anyway"),location.search.includes("show-both-forms")||(p.style.display="none");const f=document.querySelector(d("email-source")),m=document.querySelector(d("email-target"));t("Email elements found:",!!f,!!m),f&&m||t("Email elements not found, continuing anyway");const g=document.querySelector(d("country-select")),q=document.querySelector(d("us-state-select"));t("Country/state selects found:",!!g,!!q),g&&q||t("Country/state selects not found, continuing anyway");const v=a(y,d("use-select"));t("Perch use select found:",!!v),v||t("Perch use select not found, continuing anyway");const S=document.querySelector(d("quantity-counter")),w=document.querySelectorAll(d("quantity-counter-button")),E=document.querySelectorAll(d("quantity-display"));t("Quantity elements found:",!!S,w.length,E.length),S||t("Quantity counter not found, continuing anyway");const b=document.querySelectorAll(d("plan-card-wrapper")),T=document.querySelectorAll("input[type='radio'][name='desired_subscription_plans']"),A=document.querySelectorAll(d("selected-plan-display"));t("Plan elements found:",b.length,T.length,A.length);const P=a(p,d("pricing-quote-tabs"));t("Pricing quote tabs found:",!!P),P||t("Pricing quote tabs not found, this may cause issues");t("Cost summary wraps found:",document.querySelectorAll(d("cost-summary-wrap")).length);const x=document.querySelector(d("haas-recurring-annual-cost")),L=document.querySelector(d("grand-total-cost-haas")),C=document.querySelector(d("cash-recurring-annual-cost")),k=document.querySelector(d("cash-year-1-total")),_=document.querySelector(d("grand-total-cost-cash"));t("Pricing elements found:","haasRecurringAnnualCost:",!!x,"haasTotalCost:",!!L,"cashRecurringAnnualCost:",!!C,"cashYear1Total:",!!k,"cashTotalCost:",!!_);const H=document.querySelectorAll(d("custom-pricing-tag")),$=document.querySelectorAll(d("custom-pricing-tooltip-quantity")),N=document.querySelectorAll(d("custom-pricing-tooltip-plan"));t("Custom pricing elements found:","customPricingTags:",H.length,"customPricingTooltipsQuantity:",$.length,"customPricingTooltipsPlan:",N.length),$.forEach((e=>{e&&(e.style.display="none")})),N.forEach((e=>{e&&(e.style.display="none")})),z(),q&&(q.value="Alabama"),g&&q&&(g.addEventListener("change",(()=>{g.value===s?q.style.display="block":q.style.display="none",g.value==u||g.value===s&&q.value==u?B(1):D(1)})),q.addEventListener("change",(()=>{g.value===s&&q.value==u?B(1):g.value===s&&q.value!=u&&D(1)}))),v&&v.addEventListener("change",(()=>{v.value===u?z():function(){let e=document.querySelector('[data-submit="true"]');e&&(e.style.pointerEvents="auto",e.style.opacity="1",e.classList.remove("disabled"))}()})),y&&y.addEventListener("submit",(async e=>{e.preventDefault(),h&&(h.style.display="flex"),y.style.display="none",p.style.display="block",R(),window.scrollTo(0,0),await r(2500),h&&(h.style.display="none"),m&&f&&(m.value=f.value)}));const U=n(p,".c-toggle__button");function I(e){b.forEach((e=>{for(let t of e.children)t.classList.remove(i)}));for(let t of e.children)t.classList.add(i)}function Q(){if(t("Updating pricing"),!P)return void t("Pricing quote tabs not found, cannot update pricing");let e=function(e,t){let n=Array.from(e.querySelectorAll(`input[type='radio'][name='${t}']`)).find((e=>e.checked));return n?n.value:null}(p,"desired_subscription_plans");if(t("Selected plan:",e),"Standard"!==e)return t("Non-standard plan selected, showing error"),void c("plan");let r=parseInt(S?S.value:"1");t("Current quantity:",r);let i=Array.from(b).find((e=>{let t=e.querySelector("input[type='radio'][name='desired_subscription_plans']");return t&&t.checked}));if(!i)return void t("No plan card wrapper found for selected plan");let{planName:s,priceByQuantity:u}=function(e){t("Getting plan details from",e);let r=a(e,"[pp='plan-name']")?.innerText.trim()||"";if(!r)return t("Could not find plan name"),{planName:"",priceByQuantity:{}};t("Plan name:",r);let o={},l=n(e,"[data-pp-quantity][data-pp-price]");return t("Price elements:",l.length),l.forEach((e=>{let n=parseInt(e.getAttribute("data-pp-quantity")),a=parseInt(e.getAttribute("data-pp-price"));isNaN(n)||isNaN(a)||(o[n]=a,t(`Price for quantity ${n}: ${a}`))})),{planName:r,priceByQuantity:o}}(i);t("Plan details:",s,u);let y=function(e,n){let a=Object.keys(e).map((e=>parseInt(e))).sort(((e,t)=>e-t)),r=0;t("Available quantities:",a),t("Requested quantity:",n);for(let o=0;o<a.length;o++)if(n<=a[o]){r=e[a[o]],t(`Selected price: ${r} for quantity ${a[o]}`);break}return r}(u,r)*r;t("Software cost:",y);let h=0,f=0;const m=n(p,d("hardware-item"));t("Hardware items found:",m.length),m.forEach((e=>{let n=e.querySelector(".c-toggle__button");if(n&&n.checked){t("Hardware item checked:",e.querySelector(d("hardware-name"))?.innerText);let n=parseFloat(o(a(e,d("hardware-price-haas"))?.innerText||"0","$").replace(/,/g,"")),l=parseFloat(o(a(e,d("hardware-price-cash"))?.innerText||"0","$").replace(/,/g,""));t("Hardware prices - HaaS:",n,"Cash:",l),h+=n*r,f+=l*r}})),t("Total hardware prices - HaaS:",h,"Cash:",f);let g=y+h,q=y+f;if(t("Total costs - HaaS:",g,"Cash:",q),g>15e3)return t("Total HaaS cost exceeds 15000, showing error"),void c("quantity");t("Hiding errors"),$.forEach((e=>{e&&(e.style.display="none")})),N.forEach((e=>{e&&(e.style.display="none")})),H.forEach((e=>{e&&(e.style.display="none")})),x&&(t("Updating haasRecurringAnnualCost to:",l(y)),x.innerText=l(y)),L&&(t("Updating haasTotalCost to:",l(g)),L.innerText=l(g)),C&&(t("Updating cashRecurringAnnualCost to:",l(y)),C.innerText=l(y)),k&&(t("Updating cashYear1Total to:",l(q)),k.innerText=l(q)),_&&(t("Updating cashTotalCost to:",l(q)),_.innerText=l(q)),t("Pricing update complete")}function R(){t("Hiding pricing"),C&&(C.innerText=""),k&&(k.innerText=""),_&&(_.innerText=""),x&&(x.innerText=""),L&&(L.innerText="")}function B(e){let t=document.querySelectorAll('button[data-form="next-btn"]');if(t.length>e){let n=t[e];n.style.pointerEvents="none",n.style.opacity="0.5",n.classList.add("disabled")}}function D(e){let t=document.querySelectorAll('button[data-form="next-btn"]');if(t.length>e){let n=t[e];n.style.pointerEvents="auto",n.style.opacity="1",n.classList.remove("disabled")}}function z(){let e=document.querySelector('[data-submit="true"]');e&&(e.style.pointerEvents="none",e.style.opacity="0.5",e.classList.add("disabled"))}t("Hardware toggle buttons found:",U.length),U.forEach((e=>{e.addEventListener("click",(a=>{if(e.hasAttribute("readonly"))return void a.preventDefault();let r=e.closest(d("hardware-item"));if(!r)return void t("Hardware item not found for button");let o=r.querySelector(d("hardware-name")),l=o?.innerText||"",c=r.querySelector(".c-toggle__text");t("Hardware item clicked:",l,"Checked:",e.checked),c&&(e.checked?c.classList.add("cc-active"):c.classList.remove("cc-active")),n(p,d("pricing-hardware-item")).filter((e=>{let t=e.querySelector(d("hardware-name"))?.innerHTML||"";return n=l,t.toLowerCase()===n.toLowerCase();var n})).forEach((t=>{e.checked?t.classList.add("cc-active"):t.classList.remove("cc-active")}))}))})),w.length>0&&S&&w.forEach((e=>{e.addEventListener("click",(async()=>{await r(0);let e=S.value;t("Quantity changed to:",e),E.forEach((t=>{t&&(t.innerText=e)})),Q()}))})),T.length>0&&T.forEach((e=>{let n=e.closest(d("plan-card-wrapper"));n&&("Professional"===e.value&&(e.checked=!0,I(n),A.forEach((t=>{t&&(t.innerText=e.value)}))),e.addEventListener("change",(()=>{t("Plan changed to:",e.value),I(n),A.forEach((t=>{t&&(t.innerText=e.value)})),function(){let e=document.getElementById("quote");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}()})))})),U.forEach((e=>{e.addEventListener("click",Q)})),T.forEach((e=>{e.addEventListener("change",Q)})),setTimeout(Q,1e3),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".faq_wrap");0!==e.length&&e.forEach((e=>{const t=e.querySelectorAll(".faq_item");if(t.length>0){const e=t[0].querySelector('input[type="radio"]');e&&(e.checked=!0)}}))})),t("Perch Pricing Calculator initialization complete")})();
